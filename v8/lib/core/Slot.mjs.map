{"version":3,"file":"Slot.mjs","sources":["../../src/core/Slot.ts"],"sourcesContent":["import { Color, ISlot } from '@pixi-spine/base';\r\n\r\nimport { Attachment, VertexAttachment } from './attachments/Attachment';\r\nimport type { Bone } from './Bone';\r\nimport type { SlotData } from './SlotData';\r\nimport type { Skeleton } from './Skeleton';\r\n\r\n/** Stores a slot's current pose. Slots organize attachments for {@link Skeleton#drawOrder} purposes and provide a place to store\r\n * state for an attachment. State cannot be stored in an attachment itself because attachments are stateless and may be shared\r\n * across multiple skeletons.\r\n * @public\r\n * */\r\nexport class Slot implements ISlot {\r\n    // this is canon\r\n    blendMode: string;\r\n    /** The slot's setup pose data. */\r\n    data: SlotData;\r\n\r\n    /** The bone this slot belongs to. */\r\n    bone: Bone;\r\n\r\n    /** The color used to tint the slot's attachment. If {@link #getDarkColor()} is set, this is used as the light color for two\r\n     * color tinting. */\r\n    color: Color;\r\n\r\n    /** The dark color used to tint the slot's attachment for two color tinting, or null if two color tinting is not used. The dark\r\n     * color's alpha is not used. */\r\n    darkColor: Color | null = null;\r\n\r\n    attachment: Attachment | null = null;\r\n\r\n    attachmentState = 0;\r\n\r\n    /** The index of the texture region to display when the slot's attachment has a {@link Sequence}. -1 represents the\r\n     * {@link Sequence#getSetupIndex()}. */\r\n    sequenceIndex = -1;\r\n\r\n    /** Values to deform the slot's attachment. For an unweighted mesh, the entries are local positions for each vertex. For a\r\n     * weighted mesh, the entries are an offset for each vertex which will be added to the mesh's local vertex positions.\r\n     *\r\n     * See {@link VertexAttachment#computeWorldVertices()} and {@link DeformTimeline}. */\r\n    deform = new Array<number>();\r\n\r\n    constructor(data: SlotData, bone: Bone) {\r\n        if (!data) throw new Error('data cannot be null.');\r\n        if (!bone) throw new Error('bone cannot be null.');\r\n        this.data = data;\r\n        this.bone = bone;\r\n        this.color = new Color();\r\n        this.darkColor = !data.darkColor ? null : new Color();\r\n        this.setToSetupPose();\r\n\r\n        this.blendMode = this.data.blendMode;\r\n    }\r\n\r\n    /** The skeleton this slot belongs to. */\r\n    getSkeleton(): Skeleton {\r\n        return this.bone.skeleton;\r\n    }\r\n\r\n    /** The current attachment for the slot, or null if the slot has no attachment. */\r\n    getAttachment(): Attachment | null {\r\n        return this.attachment;\r\n    }\r\n\r\n    /** Sets the slot's attachment and, if the attachment changed, resets {@link #sequenceIndex} and clears the {@link #deform}.\r\n     * The deform is not cleared if the old attachment has the same {@link VertexAttachment#getTimelineAttachment()} as the\r\n     * specified attachment. */\r\n    setAttachment(attachment: Attachment | null) {\r\n        if (this.attachment == attachment) return;\r\n        if (\r\n            !(attachment instanceof VertexAttachment) ||\r\n            !(this.attachment instanceof VertexAttachment) ||\r\n            (<VertexAttachment>attachment).timelineAttachment != (<VertexAttachment>this.attachment).timelineAttachment\r\n        ) {\r\n            this.deform.length = 0;\r\n        }\r\n        this.attachment = attachment;\r\n        this.sequenceIndex = -1;\r\n    }\r\n\r\n    /** Sets this slot to the setup pose. */\r\n    setToSetupPose() {\r\n        this.color.setFromColor(this.data.color);\r\n        if (this.darkColor) this.darkColor.setFromColor(this.data.darkColor);\r\n        if (!this.data.attachmentName) this.attachment = null;\r\n        else {\r\n            this.attachment = null;\r\n            this.setAttachment(this.bone.skeleton.getAttachment(this.data.index, this.data.attachmentName));\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;AAYO,MAAM,IAAsB,CAAA;AAAA,EA+B/B,WAAA,CAAY,MAAgB,IAAY,EAAA;AAhBxC;AAAA;AAAA,IAA0B,IAAA,CAAA,SAAA,GAAA,IAAA,CAAA;AAE1B,IAAgC,IAAA,CAAA,UAAA,GAAA,IAAA,CAAA;AAEhC,IAAkB,IAAA,CAAA,eAAA,GAAA,CAAA,CAAA;AAIlB;AAAA;AAAA,IAAgB,IAAA,CAAA,aAAA,GAAA,CAAA,CAAA,CAAA;AAMhB;AAAA;AAAA;AAAA;AAAA,IAAA,IAAA,CAAA,MAAA,GAAS,IAAI,KAAc,EAAA,CAAA;AAGvB,IAAA,IAAI,CAAC,IAAA;AAAM,MAAM,MAAA,IAAI,MAAM,sBAAsB,CAAA,CAAA;AACjD,IAAA,IAAI,CAAC,IAAA;AAAM,MAAM,MAAA,IAAI,MAAM,sBAAsB,CAAA,CAAA;AACjD,IAAA,IAAA,CAAK,IAAO,GAAA,IAAA,CAAA;AACZ,IAAA,IAAA,CAAK,IAAO,GAAA,IAAA,CAAA;AACZ,IAAK,IAAA,CAAA,KAAA,GAAQ,IAAI,KAAM,EAAA,CAAA;AACvB,IAAA,IAAA,CAAK,YAAY,CAAC,IAAA,CAAK,SAAY,GAAA,IAAA,GAAO,IAAI,KAAM,EAAA,CAAA;AACpD,IAAA,IAAA,CAAK,cAAe,EAAA,CAAA;AAEpB,IAAK,IAAA,CAAA,SAAA,GAAY,KAAK,IAAK,CAAA,SAAA,CAAA;AAAA,GAC/B;AAAA;AAAA,EAGA,WAAwB,GAAA;AACpB,IAAA,OAAO,KAAK,IAAK,CAAA,QAAA,CAAA;AAAA,GACrB;AAAA;AAAA,EAGA,aAAmC,GAAA;AAC/B,IAAA,OAAO,IAAK,CAAA,UAAA,CAAA;AAAA,GAChB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,UAA+B,EAAA;AACzC,IAAA,IAAI,KAAK,UAAc,IAAA,UAAA;AAAY,MAAA,OAAA;AACnC,IACI,IAAA,EAAE,UAAsB,YAAA,gBAAA,CAAA,IACxB,EAAE,IAAA,CAAK,UAAsB,YAAA,gBAAA,CAAA,IACV,UAAY,CAAA,kBAAA,IAAyC,IAAK,CAAA,UAAA,CAAY,kBAC3F,EAAA;AACE,MAAA,IAAA,CAAK,OAAO,MAAS,GAAA,CAAA,CAAA;AAAA,KACzB;AACA,IAAA,IAAA,CAAK,UAAa,GAAA,UAAA,CAAA;AAClB,IAAA,IAAA,CAAK,aAAgB,GAAA,CAAA,CAAA,CAAA;AAAA,GACzB;AAAA;AAAA,EAGA,cAAiB,GAAA;AACb,IAAA,IAAA,CAAK,KAAM,CAAA,YAAA,CAAa,IAAK,CAAA,IAAA,CAAK,KAAK,CAAA,CAAA;AACvC,IAAA,IAAI,IAAK,CAAA,SAAA;AAAW,MAAA,IAAA,CAAK,SAAU,CAAA,YAAA,CAAa,IAAK,CAAA,IAAA,CAAK,SAAS,CAAA,CAAA;AACnE,IAAI,IAAA,CAAC,KAAK,IAAK,CAAA,cAAA;AAAgB,MAAA,IAAA,CAAK,UAAa,GAAA,IAAA,CAAA;AAAA,SAC5C;AACD,MAAA,IAAA,CAAK,UAAa,GAAA,IAAA,CAAA;AAClB,MAAK,IAAA,CAAA,aAAA,CAAc,IAAK,CAAA,IAAA,CAAK,QAAS,CAAA,aAAA,CAAc,IAAK,CAAA,IAAA,CAAK,KAAO,EAAA,IAAA,CAAK,IAAK,CAAA,cAAc,CAAC,CAAA,CAAA;AAAA,KAClG;AAAA,GACJ;AACJ;;;;"}