{"version":3,"file":"Skin.js","sources":["../../src/core/Skin.ts"],"sourcesContent":["import { Attachment, MeshAttachment } from './attachments';\r\nimport type { BoneData } from './BoneData';\r\nimport type { ConstraintData } from './ConstraintData';\r\nimport type { Skeleton } from './Skeleton';\r\n\r\nimport type { StringMap, ISkin } from '@pixi-spine/base';\r\n\r\n/** Stores an entry in the skin consisting of the slot index, name, and attachment\r\n * @public\r\n * **/\r\nexport class SkinEntry {\r\n    constructor(public slotIndex: number, public name: string, public attachment: Attachment) {}\r\n}\r\n\r\n/** Stores attachments by slot index and attachment name.\r\n *\r\n * See SkeletonData {@link SkeletonData#defaultSkin}, Skeleton {@link Skeleton#skin}, and\r\n * [Runtime skins](http://esotericsoftware.com/spine-runtime-skins) in the Spine Runtimes Guide.\r\n * @public\r\n * */\r\nexport class Skin implements ISkin {\r\n    /** The skin's name, which is unique across all skins in the skeleton. */\r\n    name: string;\r\n\r\n    attachments = new Array<StringMap<Attachment>>();\r\n    bones = Array<BoneData>();\r\n    constraints = new Array<ConstraintData>();\r\n\r\n    constructor(name: string) {\r\n        if (!name) throw new Error('name cannot be null.');\r\n        this.name = name;\r\n    }\r\n\r\n    /** Adds an attachment to the skin for the specified slot index and name. */\r\n    setAttachment(slotIndex: number, name: string, attachment: Attachment) {\r\n        if (!attachment) throw new Error('attachment cannot be null.');\r\n        const attachments = this.attachments;\r\n\r\n        if (slotIndex >= attachments.length) attachments.length = slotIndex + 1;\r\n        if (!attachments[slotIndex]) attachments[slotIndex] = {};\r\n        attachments[slotIndex][name] = attachment;\r\n    }\r\n\r\n    /** Adds all attachments, bones, and constraints from the specified skin to this skin. */\r\n    addSkin(skin: Skin) {\r\n        for (let i = 0; i < skin.bones.length; i++) {\r\n            const bone = skin.bones[i];\r\n            let contained = false;\r\n\r\n            for (let ii = 0; ii < this.bones.length; ii++) {\r\n                if (this.bones[ii] == bone) {\r\n                    contained = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!contained) this.bones.push(bone);\r\n        }\r\n\r\n        for (let i = 0; i < skin.constraints.length; i++) {\r\n            const constraint = skin.constraints[i];\r\n            let contained = false;\r\n\r\n            for (let ii = 0; ii < this.constraints.length; ii++) {\r\n                if (this.constraints[ii] == constraint) {\r\n                    contained = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!contained) this.constraints.push(constraint);\r\n        }\r\n\r\n        const attachments = skin.getAttachments();\r\n\r\n        for (let i = 0; i < attachments.length; i++) {\r\n            const attachment = attachments[i];\r\n\r\n            this.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n        }\r\n    }\r\n\r\n    /** Adds all bones and constraints and copies of all attachments from the specified skin to this skin. Mesh attachments are not\r\n     * copied, instead a new linked mesh is created. The attachment copies can be modified without affecting the originals. */\r\n    copySkin(skin: Skin) {\r\n        for (let i = 0; i < skin.bones.length; i++) {\r\n            const bone = skin.bones[i];\r\n            let contained = false;\r\n\r\n            for (let ii = 0; ii < this.bones.length; ii++) {\r\n                if (this.bones[ii] == bone) {\r\n                    contained = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!contained) this.bones.push(bone);\r\n        }\r\n\r\n        for (let i = 0; i < skin.constraints.length; i++) {\r\n            const constraint = skin.constraints[i];\r\n            let contained = false;\r\n\r\n            for (let ii = 0; ii < this.constraints.length; ii++) {\r\n                if (this.constraints[ii] == constraint) {\r\n                    contained = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!contained) this.constraints.push(constraint);\r\n        }\r\n\r\n        const attachments = skin.getAttachments();\r\n\r\n        for (let i = 0; i < attachments.length; i++) {\r\n            const attachment = attachments[i];\r\n\r\n            if (!attachment.attachment) continue;\r\n            if (attachment.attachment instanceof MeshAttachment) {\r\n                attachment.attachment = attachment.attachment.newLinkedMesh();\r\n                this.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n            } else {\r\n                attachment.attachment = attachment.attachment.copy();\r\n                this.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Returns the attachment for the specified slot index and name, or null. */\r\n    getAttachment(slotIndex: number, name: string): Attachment | null {\r\n        const dictionary = this.attachments[slotIndex];\r\n\r\n        return dictionary ? dictionary[name] : null;\r\n    }\r\n\r\n    /** Removes the attachment in the skin for the specified slot index and name, if any. */\r\n    removeAttachment(slotIndex: number, name: string) {\r\n        const dictionary = this.attachments[slotIndex];\r\n\r\n        if (dictionary) delete dictionary[name];\r\n    }\r\n\r\n    /** Returns all attachments in this skin. */\r\n    getAttachments(): Array<SkinEntry> {\r\n        const entries = new Array<SkinEntry>();\r\n\r\n        for (let i = 0; i < this.attachments.length; i++) {\r\n            const slotAttachments = this.attachments[i];\r\n\r\n            if (slotAttachments) {\r\n                for (const name in slotAttachments) {\r\n                    const attachment = slotAttachments[name];\r\n\r\n                    if (attachment) entries.push(new SkinEntry(i, name, attachment));\r\n                }\r\n            }\r\n        }\r\n\r\n        return entries;\r\n    }\r\n\r\n    /** Returns all attachments in this skin for the specified slot index. */\r\n    getAttachmentsForSlot(slotIndex: number, attachments: Array<SkinEntry>) {\r\n        const slotAttachments = this.attachments[slotIndex];\r\n\r\n        if (slotAttachments) {\r\n            for (const name in slotAttachments) {\r\n                const attachment = slotAttachments[name];\r\n\r\n                if (attachment) attachments.push(new SkinEntry(slotIndex, name, attachment));\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Clears all attachments, bones, and constraints. */\r\n    clear() {\r\n        this.attachments.length = 0;\r\n        this.bones.length = 0;\r\n        this.constraints.length = 0;\r\n    }\r\n\r\n    /** Attach each attachment in this skin if the corresponding attachment in the old skin is currently attached. */\r\n    attachAll(skeleton: Skeleton, oldSkin: Skin) {\r\n        let slotIndex = 0;\r\n\r\n        for (let i = 0; i < skeleton.slots.length; i++) {\r\n            const slot = skeleton.slots[i];\r\n            const slotAttachment = slot.getAttachment();\r\n\r\n            if (slotAttachment && slotIndex < oldSkin.attachments.length) {\r\n                const dictionary = oldSkin.attachments[slotIndex];\r\n\r\n                for (const key in dictionary) {\r\n                    const skinAttachment: Attachment = dictionary[key];\r\n\r\n                    if (slotAttachment == skinAttachment) {\r\n                        const attachment = this.getAttachment(slotIndex, key);\r\n\r\n                        if (attachment) slot.setAttachment(attachment);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            slotIndex++;\r\n        }\r\n    }\r\n}\r\n"],"names":["MeshAttachment"],"mappings":"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"}